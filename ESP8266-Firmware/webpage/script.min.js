var content="Content-type";var ctype="application/x-www-form-urlencoded";var cjson="application/json";function saveTextAsFile(){var b="";for(var d=0;d<192;d++){b=b+(localStorage[d])+"\n"}var c=new Blob([b],{type:"text/plain"});var a=document.getElementById("downloadlink");a.download=document.getElementById("filename").value;if(window.webkitURL!=null){a.href=window.webkitURL.createObjectURL(c)}else{if(window.navigator.msSaveOrOpenBlob){a.addEventListener("click",function(){window.navigator.msSaveBlob(c,document.getElementById("filename").value)})}else{a.href=window.URL.createObjectURL(c)}}a.click()}function refresh(){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var a=JSON.parse(xhr.responseText);document.getElementById("descr").innerHTML=a.descr.replace(/\\/g,"");document.getElementById("name").innerHTML=a.name.replace(/\\/g,"");document.getElementById("bitr").innerHTML=a.bitr.replace(/\\/g,"");document.getElementById("not1").innerHTML=a.not1.replace(/\\/g,"").replace(/^<BR>/,"");document.getElementById("not2").innerHTML=a.not2.replace(/\\/g,"");document.getElementById("genre").innerHTML=a.genre.replace(/\\/g,"");document.getElementById("url1").innerHTML=a.url1.replace(/\\/g,"");document.getElementById("url2").href=a.url1.replace(/\\/g,"");document.getElementById("vol_range").value=a.vol.replace(/\\/g,"");document.getElementById("treble_range").value=a.treb.replace(/\\/g,"");document.getElementById("bass_range").value=a.bass.replace(/\\/g,"");document.getElementById("treblefreq_range").value=a.tfreq.replace(/\\/g,"");document.getElementById("bassfreq_range").value=a.bfreq.replace(/\\/g,"");document.getElementById("spacial_range").value=a.spac.replace(/\\/g,"");onRangeVolChange(document.getElementById("vol_range").value);onRangeChange("treble_range","treble_span",1.5,false,true);onRangeChange("bass_range","bass_span",1,false,true);onRangeChangeFreqTreble("treblefreq_range","treblefreq_span",1,false,true);onRangeChangeFreqBass("bassfreq_range","bassfreq_span",10,false,true);onRangeChangeSpatial("spacial_range","spacial_span",true)}};xhr.open("POST","icy",true);xhr.setRequestHeader(content,ctype);xhr.send("&")}function onRangeChange(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML=(d*e)+" dB";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqTreble(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML="From "+(d*e)+" kHz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqBass(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML="Under "+(d*e)+" Hz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeSpatial(e,c,b){var d=document.getElementById(e).value;var a;switch(d){case"0":a="Off";break;case"1":a="Minimal";break;case"2":a="Normal";break;case"3":a="Maximal";break}document.getElementById(c).innerHTML=a;if(typeof(b)=="undefined"){saveSoundSettings()}}function onRangeVolChange(a){var b=document.getElementById("vol_range").max-a;document.getElementById("vol1_span").innerHTML=(b*-0.5)+" dB";document.getElementById("vol_span").innerHTML=(b*-0.5)+" dB";document.getElementById("vol_range").value=a;document.getElementById("vol1_range").value=a;xhr=new XMLHttpRequest();xhr.open("POST","soundvol",false);xhr.setRequestHeader(content,ctype);xhr.send("vol="+a+"&")}function instantPlay(){xhr=new XMLHttpRequest();xhr.open("POST","instant_play",false);xhr.setRequestHeader(content,ctype);if(!(document.getElementById("instant_path").value.substring(0,1)==="/")){document.getElementById("instant_path").value="/"+document.getElementById("instant_path").value}document.getElementById("instant_url").value=document.getElementById("instant_url").value.replace(/^https?:\/\//,"");xhr.send("url="+document.getElementById("instant_url").value+"&port="+document.getElementById("instant_port").value+"&path="+document.getElementById("instant_path").value+"&");window.setTimeout(refresh,200)}function playStation(){select=document.getElementById("stationsSelect");localStorage.setItem("selindexstore",select.options.selectedIndex.toString());xhr=new XMLHttpRequest();xhr.open("POST","play",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+select.options[select.options.selectedIndex].id+"&");window.setTimeout(refresh,200)}function stopStation(){var a=document.getElementById("stationsSelect");localStorage.setItem("selindexstore",a.options.selectedIndex.toString());xhr=new XMLHttpRequest();xhr.open("POST","stop",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+a.options[a.options.selectedIndex].id+"&")}function saveSoundSettings(){xhr=new XMLHttpRequest();xhr.open("POST","sound",false);xhr.setRequestHeader(content,ctype);xhr.send("&bass="+document.getElementById("bass_range").value+"&treble="+document.getElementById("treble_range").value+"&bassfreq="+document.getElementById("bassfreq_range").value+"&treblefreq="+document.getElementById("treblefreq_range").value+"&spacial="+document.getElementById("spacial_range").value+"&")}function saveStation(){var b=document.getElementById("add_path").value;var a=document.getElementById("add_url").value;if(!(b.substring(0,1)==="/")){b="/"+b}a=a.replace(/^https?:\/\//,"");xhr=new XMLHttpRequest();xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+document.getElementById("add_slot").value+"&url="+a+"&name="+document.getElementById("add_name").value+"&file="+b+"&port="+document.getElementById("add_port").value+"&");localStorage.setItem(document.getElementById("add_slot").value,'{"Name":"'+document.getElementById("add_name").value+'","URL":"'+a+'","File":"'+b+'","Port":"'+document.getElementById("add_port").value+'"}');window.location.reload(false)}function editStation(c){function b(){document.getElementById("add_url").value=a.URL;document.getElementById("add_name").value=a.Name;document.getElementById("add_path").value=a.File;document.getElementById("add_port").value=a.Port;document.getElementById("editStationDiv").style.display="block";setMainHeight("tab-content2")}document.getElementById("add_slot").value=c;idstr=c.toString();if(localStorage.getItem(idstr)!=null){var a=JSON.parse(localStorage.getItem(idstr));b()}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var d=JSON.parse(xhr.responseText);b()}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+c+"&")}}function loadStations(d){var b=document.createElement("tbody");var f=16*(d-1);function c(k,g){var i=document.createElement("TR");var j=document.createElement("TD");j.appendChild(document.createTextNode(k+1));j.style.width="10%";i.appendChild(j);for(var h in g){var j=document.createElement("TD");if(g[h].length>64){g[h]="Error"}j.appendChild(document.createTextNode(g[h]));i.appendChild(j)}var j=document.createElement("TD");j.innerHTML='<a href="#" onClick="editStation('+k+')">Edit</a>';i.appendChild(j);b.appendChild(i)}for(f;f<16*d;f++){idstr=f.toString();if(localStorage.getItem(idstr)!=null){var a=JSON.parse(localStorage.getItem(idstr));c(f,a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var g=JSON.parse(xhr.responseText);localStorage.setItem(idstr,xhr.responseText);c(f,g)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+f+"&")}}var e=document.getElementById("stationsTable").getElementsByTagName("tbody")[0];e.parentNode.replaceChild(b,e);setMainHeight("tab-content2")}function loadStationsList(b){var d=false;function c(i,f){var h=false;if(f.Name.length>0){var g=document.createElement("option");g.appendChild(document.createTextNode(f.Name));g.id=i;document.getElementById("stationsSelect").appendChild(g)}else{h=true}return h}document.getElementById("stationsSelect").disabled=true;for(var e=0;e<b;e++){idstr=e.toString();if(localStorage.getItem(idstr)!=null){var a=JSON.parse(localStorage.getItem(idstr));d=c(e,a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var f=JSON.parse(xhr.responseText);localStorage.setItem(idstr,xhr.responseText);d=c(e,f)}};xhr.open("POST","getStation",true);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+e+"&")}}select=document.getElementById("stationsSelect");select.disabled=false;select.options.selectedIndex=parseInt(localStorage.getItem("selindexstore"))}function setMainHeight(a){var c=window.innerHeight;var b=document.getElementById(a).offsetHeight+200;if(b<c){b=c}document.getElementById("MAIN").style.height=b}document.addEventListener("DOMContentLoaded",function(){document.getElementById("tab1").addEventListener("click",function(){setMainHeight("tab-content1")});document.getElementById("tab2").addEventListener("click",function(){loadStations(1);setMainHeight("tab-content2")});document.getElementById("tab3").addEventListener("click",function(){setMainHeight("tab-content3")});loadStationsList(191);refresh();setMainHeight("tab-content1");window.setInterval(refresh,10000)});