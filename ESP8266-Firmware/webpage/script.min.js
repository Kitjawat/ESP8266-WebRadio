var content="Content-type";var ctype="application/x-www-form-urlencoded";var cjson="application/json";function chkip(a){if(/^([0-9]+\.){3}[0-9]+$/.test(a.value)){a.style.color="green"}else{a.style.color="red"}}function clickdhcp(){if(document.getElementById("dhcp").checked){document.getElementById("ip").setAttribute("disabled","");document.getElementById("mask").setAttribute("disabled","");document.getElementById("gw").setAttribute("disabled","")}else{document.getElementById("ip").removeAttribute("disabled");document.getElementById("mask").removeAttribute("disabled");document.getElementById("gw").removeAttribute("disabled")}}function valid(){wifi(1);alert("System reboot. Please change your browser address to the new one.")}function promptworking(a){document.getElementById("working").innerHTML=a;if(a==""){document.getElementById("working").style.display="none"}else{document.getElementById("working").style.display="block"}}function saveTextAsFile(){var b="";promptworking("Working... Please wait");for(var d=0;d<191;d++){b=b+(localStorage[d])+"\n"}var c=new Blob([b],{type:"text/plain"});var a=document.getElementById("downloadlink");a.download=document.getElementById("filesave").value;if(a.download==""){alert("Please give a file name")}else{if(window.webkitURL!=null){a.href=window.webkitURL.createObjectURL(c)}else{if(window.navigator.msSaveOrOpenBlob){a.addEventListener("click",function(){window.navigator.msSaveBlob(c,a.download)})}else{a.href=window.URL.createObjectURL(c)}}promptworking("");a.click()}}function refresh(){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){try{var a=JSON.parse(xhr.responseText);if(a.descr==""){document.getElementById("ldescr").style.display="none"}else{document.getElementById("ldescr").style.display="inline-block"}document.getElementById("descr").innerHTML=a.descr.replace(/\\/g,"");document.getElementById("name").innerHTML=a.name.replace(/\\/g,"");if(a.bitr==""){document.getElementById("lbitr").style.display="none"}else{document.getElementById("lbitr").style.display="inline-block"}document.getElementById("bitr").innerHTML=a.bitr.replace(/\\/g,"")+" kB/s";if(a.bitr==""){document.getElementById("bitr").innerHTML=""}if((a.not1=="")&&(a.not2=="")){document.getElementById("lnot1").style.display="none"}else{document.getElementById("lnot1").style.display="inline-block"}document.getElementById("not1").innerHTML=a.not1.replace(/\\/g,"").replace(/^<BR>/,"");document.getElementById("not2").innerHTML=a.not2.replace(/\\/g,"");if(a.genre==""){document.getElementById("lgenre").style.display="none"}else{document.getElementById("lgenre").style.display="inline-block"}document.getElementById("genre").innerHTML=a.genre.replace(/\\/g,"");if(a.url1==""){document.getElementById("lurl").style.display="none"}else{document.getElementById("lurl").style.display="inline-block"}document.getElementById("url1").innerHTML=a.url1.replace(/\\/g,"");document.getElementById("url2").href=a.url1.replace(/\\/g,"");document.getElementById("meta").innerHTML=a.meta.replace(/\\/g,"");document.getElementById("vol_range").value=a.vol.replace(/\\/g,"");document.getElementById("treble_range").value=a.treb.replace(/\\/g,"");document.getElementById("bass_range").value=a.bass.replace(/\\/g,"");document.getElementById("treblefreq_range").value=a.tfreq.replace(/\\/g,"");document.getElementById("bassfreq_range").value=a.bfreq.replace(/\\/g,"");document.getElementById("spacial_range").value=a.spac.replace(/\\/g,"");onRangeVolChange(document.getElementById("vol_range").value);onRangeChange("treble_range","treble_span",1.5,false,true);onRangeChange("bass_range","bass_span",1,false,true);onRangeChangeFreqTreble("treblefreq_range","treblefreq_span",1,false,true);onRangeChangeFreqBass("bassfreq_range","bassfreq_span",10,false,true);onRangeChangeSpatial("spacial_range","spacial_span",true)}catch(b){}}};xhr.open("POST","icy",false);xhr.setRequestHeader(content,ctype);xhr.send("&")}function onRangeChange(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML=(d*e)+" dB";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqTreble(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML="From "+(d*e)+" kHz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqBass(f,c,e,b,a){var d=document.getElementById(f).value;if(b){d=document.getElementById(f).max-d}document.getElementById(c).innerHTML="Under "+(d*e)+" Hz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeSpatial(e,c,b){var d=document.getElementById(e).value;var a;switch(d){case"0":a="Off";break;case"1":a="Minimal";break;case"2":a="Normal";break;case"3":a="Maximal";break}document.getElementById(c).innerHTML=a;if(typeof(b)=="undefined"){saveSoundSettings()}}function onRangeVolChange(a){var b=document.getElementById("vol_range").max-a;document.getElementById("vol1_span").innerHTML=(b*-0.5)+" dB";document.getElementById("vol_span").innerHTML=(b*-0.5)+" dB";document.getElementById("vol_range").value=a;document.getElementById("vol1_range").value=a;xhr=new XMLHttpRequest();xhr.open("POST","soundvol",true);xhr.setRequestHeader(content,ctype);xhr.send("vol="+a+"&")}function wifi(a){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var b=JSON.parse(xhr.responseText);document.getElementById("ssid").value=b.ssid;document.getElementById("passwd").value=b.pasw;document.getElementById("ip").value=b.ip;chkip(document.getElementById("ip"));document.getElementById("mask").value=b.msk;chkip(document.getElementById("mask"));document.getElementById("gw").value=b.gw;chkip(document.getElementById("gw"));if(b.dhcp=="1"){document.getElementById("dhcp").setAttribute("checked","")}else{document.getElementById("dhcp").removeAttribute("checked")}clickdhcp()}};xhr.open("POST","wifi",false);xhr.setRequestHeader(content,ctype);xhr.send("valid="+a+"&ssid="+document.getElementById("ssid").value+"&pasw="+document.getElementById("passwd").value+"&ip="+document.getElementById("ip").value+"&msk="+document.getElementById("mask").value+"&gw="+document.getElementById("gw").value+"&dhcp="+document.getElementById("dhcp").checked+"&")}function instantPlay(){xhr=new XMLHttpRequest();xhr.open("POST","instant_play",false);xhr.setRequestHeader(content,ctype);if(!(document.getElementById("instant_path").value.substring(0,1)==="/")){document.getElementById("instant_path").value="/"+document.getElementById("instant_path").value}document.getElementById("instant_url").value=document.getElementById("instant_url").value.replace(/^https?:\/\//,"");xhr.send("url="+document.getElementById("instant_url").value+"&port="+document.getElementById("instant_port").value+"&path="+document.getElementById("instant_path").value+"&");window.setTimeout(refresh,200)}function playStation(){select=document.getElementById("stationsSelect");localStorage.setItem("selindexstore",select.options.selectedIndex.toString());xhr=new XMLHttpRequest();xhr.open("POST","play",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+select.options[select.options.selectedIndex].id+"&");window.setTimeout(refresh,200)}function stopStation(){var a=document.getElementById("stationsSelect");localStorage.setItem("selindexstore",a.options.selectedIndex.toString());xhr=new XMLHttpRequest();xhr.open("POST","stop",true);xhr.setRequestHeader(content,ctype);xhr.send("id="+a.options[a.options.selectedIndex].id+"&")}function saveSoundSettings(){xhr=new XMLHttpRequest();xhr.open("POST","sound",true);xhr.setRequestHeader(content,ctype);xhr.send("&bass="+document.getElementById("bass_range").value+"&treble="+document.getElementById("treble_range").value+"&bassfreq="+document.getElementById("bassfreq_range").value+"&treblefreq="+document.getElementById("treblefreq_range").value+"&spacial="+document.getElementById("spacial_range").value+"&")}function saveStation(){var b=document.getElementById("add_path").value;var a=document.getElementById("add_url").value;if(!(b.substring(0,1)==="/")){b="/"+b}a=a.replace(/^https?:\/\//,"");xhr=new XMLHttpRequest();xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+document.getElementById("add_slot").value+"&url="+a+"&name="+document.getElementById("add_name").value+"&file="+b+"&port="+document.getElementById("add_port").value+"&");localStorage.setItem(document.getElementById("add_slot").value,'{"Name":"'+document.getElementById("add_name").value+'","URL":"'+a+'","File":"'+b+'","Port":"'+document.getElementById("add_port").value+'"}');window.location.reload(false)}function editStation(d){function c(e){document.getElementById("add_url").value=e.URL;document.getElementById("add_name").value=e.Name;document.getElementById("add_path").value=e.File;document.getElementById("add_port").value=e.Port;document.getElementById("editStationDiv").style.display="block";setMainHeight("tab-content2")}document.getElementById("add_slot").value=d;idstr=d.toString();if(localStorage.getItem(idstr)!=null){var a;try{a=JSON.parse(localStorage.getItem(idstr))}catch(b){}c(a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var f;try{f=JSON.parse(xhr.responseText)}catch(g){}c(f)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+d+"&")}}function refreshList(){promptworking("Working.. Please Wait");localStorage.clear();loadStationsList(191);promptworking("")}function clearList(){if(confirm("Warning: This will clear all stations.\n Be sure to save station before.\nClear now?")){promptworking("Working.. Please Wait");xhr=new XMLHttpRequest();xhr.open("POST","clear",false);xhr.setRequestHeader(content,ctype);xhr.send("&&");window.setTimeout(refreshList,10);promptworking("")}}function downloadStations(){var b;eprogress=document.getElementById("progress");if(window.File&&window.FileReader&&window.FileList&&window.Blob){var a=new FileReader();xhr.onreadystatechange=function(){promptworking("Working.. Please Wait")};xhr=new XMLHttpRequest();a.onload=function(g){var f=this.result.split("\n");for(var d=0;d<f.length;d++){try{b=JSON.parse(f[d])}catch(g){}finally{xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+d+"&url="+b.URL+"&name="+b.Name+"&file="+b.File+"&port="+b.Port+"&")}}localStorage.clear();loadStationsList(191);promptworking("");window.location.reload(false)};var c=document.getElementById("fileload").files[0];if(c==null){alert("Please select a file")}else{promptworking("Working.. Please Wait");xhr.open("POST","clear",false);xhr.setRequestHeader(content,ctype);xhr.send("&&");a.readAsText(c)}}}function loadStations(d){var b=document.createElement("tbody");var h=16*(d-1);function c(l,e){var j=document.createElement("TR");var k=document.createElement("TD");k.appendChild(document.createTextNode(l+1));k.style.width="10%";j.appendChild(k);for(var i in e){var k=document.createElement("TD");if(e[i].length>64){e[i]="Error"}k.appendChild(document.createTextNode(e[i]));j.appendChild(k)}var k=document.createElement("TD");k.innerHTML='<a href="#" onClick="editStation('+l+')">Edit</a>';j.appendChild(k);b.appendChild(j)}for(h;h<16*d;h++){idstr=h.toString();if(localStorage.getItem(idstr)!=null){var a;try{a=JSON.parse(localStorage.getItem(idstr))}catch(f){}c(h,a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var i;try{i=JSON.parse(xhr.responseText)}catch(j){}localStorage.setItem(idstr,xhr.responseText);c(h,i)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+h+"&")}}var g=document.getElementById("stationsTable").getElementsByTagName("tbody")[0];g.parentNode.replaceChild(b,g);setMainHeight("tab-content2")}function loadStationsList(b){var d=false;function c(j,e){var i=false;if(e.Name.length>0){var h=document.createElement("option");h.appendChild(document.createTextNode(e.Name));h.id=j;document.getElementById("stationsSelect").appendChild(h)}else{i=true}return i}document.getElementById("stationsSelect").disabled=true;for(var g=0;g<b;g++){idstr=g.toString();if(localStorage.getItem(idstr)!=null){var a;try{a=JSON.parse(localStorage.getItem(idstr))}catch(f){}d=c(g,a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var h;try{h=JSON.parse(xhr.responseText)}catch(i){}localStorage.setItem(idstr,xhr.responseText);d=c(g,h)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+g+"&")}}select=document.getElementById("stationsSelect");select.disabled=false;select.options.selectedIndex=parseInt(localStorage.getItem("selindexstore"))}function setMainHeight(a){var c=window.innerHeight;var b=document.getElementById(a).offsetHeight+200;if(b<c){b=c}document.getElementById("MAIN").style.height=b}document.addEventListener("DOMContentLoaded",function(){document.getElementById("tab1").addEventListener("click",function(){refresh();setMainHeight("tab-content1")});document.getElementById("tab2").addEventListener("click",function(){loadStations(1);setMainHeight("tab-content2")});document.getElementById("tab3").addEventListener("click",function(){wifi(0);setMainHeight("tab-content3")});loadStationsList(191);refresh();wifi(0);setMainHeight("tab-content1");window.setInterval(refresh,5000)});